<%- include("../../views/partials/admin/header") %>
<section class="content-main">
  <div class="content-header">
    <div>
      <h2 class="content-title card-title">Dashboard</h2>
      <p>Whole data about your business here</p>
    </div>
    <div>
      <a href="/admin/salesReport" class="btn btn-primary">
        <i class="text-muted material-icons md-post_add"></i>Create report
      </a>
    </div>
  </div>
  
  <div class="row">
    <div class="col-lg-3">
      <div class="card card-body mb-4">
        <article class="icontext">
          <span class="icon icon-sm rounded-circle bg-primary-light">
            <i class="text-primary material-icons md-monetization_on"></i>
          </span>
          <div class="text">
            <h6 class="mb-1 card-title">Total Revenue</h6>
            <span>₹<%= revenueMetrics.totalSales %></span>
          </div>
        </article>
      </div>
    </div>
    <div class="col-lg-3">
      <div class="card card-body mb-4">
        <article class="icontext">
          <span class="icon icon-sm rounded-circle bg-success-light">
            <i class="text-success material-icons md-local_shipping"></i>
          </span>
          <div class="text">
            <h6 class="mb-1 card-title">Total Orders</h6>
            <span><%= revenueMetrics.totalOrders %></span>
          </div>
        </article>
      </div>
    </div>
    <div class="col-lg-3">
      <div class="card card-body mb-4">
        <article class="icontext">
          <span class="icon icon-sm rounded-circle bg-warning-light">
            <i class="text-warning material-icons md-qr_code"></i>
          </span>
          <div class="text">
            <h6 class="mb-1 card-title">Total Discounts</h6>
            <span>₹<%= revenueMetrics.totalCouponDiscount %></span>
          </div>
        </article>
      </div>
    </div>
  </div>
  
  <div class="row">
    <!-- Sales Statistics Chart -->
    <div class="col-xl-8 col-lg-8">
      <div class="card mb-4">
        <article class="card-body">
          <h5 class="card-title">best Selling Chart</h5>
          <div style="height: 300px;">
            <canvas id="myChart4"></canvas>
          </div>
        </article>
      </div>
    </div>
    
    <!-- Category Revenue Chart -->
    <div class="col-xl-4 col-lg-4">
      <div class="card mb-4">
        <article class="card-body">
          <h5>Best Selling Categories</h5>

          <div style="height: 300px;">
            <canvas id="categoryChart"></canvas>
          </div>
        </article>
      </div>
    </div>
  </div>
  
</section>

<%- include("../../views/partials/admin/footer") %>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
   // Category Revenue Chart (Donut)
   const categoryCtx = document.getElementById('categoryChart').getContext('2d');
  const categoryData = <%- JSON.stringify(categoryRevenue) %>;
  
  if (categoryData && categoryData.length > 0) {
    new Chart(categoryCtx, {
      type: 'doughnut',
      data: {
        labels: categoryData.map(item => item._id),
        datasets: [{
          data: categoryData.map(item => item.totalRevenue),
          backgroundColor: [
            'rgba(255, 99, 132, 0.8)',
            'rgba(54, 162, 235, 0.8)',
            'rgba(255, 206, 86, 0.8)',
            'rgba(75, 192, 192, 0.8)',
            'rgba(153, 102, 255, 0.8)'
          ]
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'right'
          }
        }
      }
    });
  }




  const productData = <%- JSON.stringify(bestSellingProducts) %>;
  
  if (productData && productData.length > 0) {
      const ctx = document.getElementById('myChart4').getContext('2d');
      
      new Chart(ctx, {
          type: 'bar',
          data: {
              labels: productData.map(data => data.productName),
              datasets: [{
                  label: 'Top Selling Products',
                  data: productData.map(data => data.totalQuantity),
                  backgroundColor: '#8BE8E5',  // Light turquoise color
                  borderColor: '#8BE8E5',
                  borderWidth: 0
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                  legend: {
                      display: true,
                      position: 'top',
                      align: 'start',
                      labels: {
                          boxWidth: 12,
                          padding: 20
                      }
                  },
                  tooltip: {
                      enabled: true,
                      backgroundColor: 'white',
                      titleColor: 'black',
                      bodyColor: 'black',
                      borderColor: '#ddd',
                      borderWidth: 1,
                      padding: 12,
                      displayColors: false,
                      callbacks: {
                          title: function(tooltipItems) {
                              return tooltipItems[0].label;
                          },
                          label: function(context) {
                              return `Quantity: ${context.raw}`;
                          }
                      }
                  }
              },
              scales: {
                  x: {
                      grid: {
                          display: false,
                          drawBorder: false
                      },
                      ticks: {
                          padding: 10,
                          color: '#666'
                      }
                  },
                  y: {
                      position: 'left',
                      grid: {
                          color: '#f0f0f0',
                          drawBorder: false,
                          lineWidth: 1
                      },
                      ticks: {
                          stepSize: 2,
                          padding: 10,
                          color: '#666'
                      },
                      beginAtZero: true,
                      max: function(context) {
                          const max = Math.max(...context.chart.data.datasets[0].data);
                          return Math.ceil(max * 1.1); // Add 10% padding to the top
                      }
                  }
              },
              layout: {
                  padding: {
                      left: 10,
                      right: 30,
                      top: 20,
                      bottom: 10
                  }
              },
              barThickness: 40, // Controls the width of the bars
          }
      });
  } else {
      const canvas = document.getElementById('myChart4');
      const ctx = canvas.getContext('2d');
      ctx.font = '14px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('No data available', canvas.width / 2, canvas.height / 2);
  }
  </script>


